<!DOCTYPE html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="glaucus Wiki"><link href=https://wiki.glaucuslinux.org/constructing-the-toolchain-and-the-chroot-environment/constructing-the-toolchain/general-compilation-instructions/ rel=canonical><meta name=author content="Firas Khalil Khana"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../../img/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-ponylang-0.2.6"><title>5.3. General Compilation Instructions - glaucus Wiki</title><link rel=stylesheet href=../../../assets/stylesheets/application.b80b25f7.css><link rel=stylesheet href=../../../assets/stylesheets/application-palette.6079476c.css><script src=../../../assets/javascripts/modernizr.0b5df86e.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700|Ubuntu+Mono"><style>body,input{font-family:"Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel=stylesheet href=../../../../../../css/extra.css></head> <body dir=ltr data-md-color-primary=blue-grey data-md-color-accent=amber> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=github> <path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z"/> </svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=../../../#53-general-compilation-instructions tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://wiki.glaucuslinux.org/ title="glaucus Wiki" class="md-header-nav__button md-logo"> <img src=../../../img/logo.svg width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> glaucus Wiki </span> <span class=md-header-nav__topic> 5.3. General Compilation Instructions </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/glaucuslinux/glaucus title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#github width=24 height=24></use> </svg> </div> <div class=md-source__repository> glaucuslinux/glaucus </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <span class="md-nav__button md-logo"> <img src=../../../img/logo.svg width=48 height=48> </span> glaucus Wiki </label> <div class=md-nav__source> <a href=https://github.com/glaucuslinux/glaucus title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#github width=24 height=24></use> </svg> </div> <div class=md-source__repository> glaucuslinux/glaucus </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Preface </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Preface </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../preface/foreword/ title="i. Foreword" class=md-nav__link> i. Foreword </a> </li> <li class=md-nav__item> <a href=../../../preface/audience/ title="ii. Audience" class=md-nav__link> ii. Audience </a> </li> <li class=md-nav__item> <a href=../../../preface/glaucus-target-architectures/ title="iii. glaucus Target Architectures" class=md-nav__link> iii. glaucus Target Architectures </a> </li> <li class=md-nav__item> <a href=../../../preface/glaucus-and-standards/ title="iv. glaucus and Standards" class=md-nav__link> iv. glaucus and Standards </a> </li> <li class=md-nav__item> <a href=../../../preface/rationale-for-cerata/ title="v. Rationale for Cerata" class=md-nav__link> v. Rationale for Cerata </a> </li> <li class=md-nav__item> <a href=../../../preface/prerequisites/ title="vi. Prerequisites" class=md-nav__link> vi. Prerequisites </a> </li> <li class=md-nav__item> <a href=../../../preface/typography/ title="vii. Typography" class=md-nav__link> vii. Typography </a> </li> <li class=md-nav__item> <a href=../../../preface/structure/ title="viii. Structure" class=md-nav__link> viii. Structure </a> </li> <li class=md-nav__item> <a href=../../../preface/errata/ title="ix. Errata" class=md-nav__link> ix. Errata </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> I. Introduction </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> I. Introduction </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-1 type=checkbox id=nav-3-1> <label class=md-nav__link for=nav-3-1> 1. Introduction </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-1> 1. Introduction </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../introduction/introduction/how-to-build-glaucus/ title="1.1. How to Build glaucus" class=md-nav__link> 1.1. How to Build glaucus </a> </li> <li class=md-nav__item> <a href=../../../introduction/introduction/resources/ title="1.2. Resources" class=md-nav__link> 1.2. Resources </a> </li> <li class=md-nav__item> <a href=../../../introduction/introduction/help/ title="1.3. Help" class=md-nav__link> 1.3. Help </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> II. Constructing the Toolchain and the Chroot Environment </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> II. Constructing the Toolchain and the Chroot Environment </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1 type=checkbox id=nav-4-1> <label class=md-nav__link for=nav-4-1> 2. Preparing the Host System </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-1> 2. Preparing the Host System </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../preparing-the-host-system/introduction/ title="2.1. Introduction" class=md-nav__link> 2.1. Introduction </a> </li> <li class=md-nav__item> <a href=../../preparing-the-host-system/host-system-requirements/ title="2.2. Host System Requirements" class=md-nav__link> 2.2. Host System Requirements </a> </li> <li class=md-nav__item> <a href=../../preparing-the-host-system/building-glaucus-in-stages/ title="2.3. Building glaucus in Stages" class=md-nav__link> 2.3. Building glaucus in Stages </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-2 type=checkbox id=nav-4-2> <label class=md-nav__link for=nav-4-2> 3. Cerata and Patches </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-2> 3. Cerata and Patches </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cerata-and-patches/introduction/ title="3.1. Introduction" class=md-nav__link> 3.1. Introduction </a> </li> <li class=md-nav__item> <a href=../../cerata-and-patches/all-cerata/ title="3.2. All Cerata" class=md-nav__link> 3.2. All Cerata </a> </li> <li class=md-nav__item> <a href=../../cerata-and-patches/needed-patches/ title="3.3. Needed Patches" class=md-nav__link> 3.3. Needed Patches </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-3 type=checkbox id=nav-4-3> <label class=md-nav__link for=nav-4-3> 4. Final Preparations </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-3> 4. Final Preparations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../final-preparations/introduction/ title="4.1. Introduction" class=md-nav__link> 4.1. Introduction </a> </li> <li class=md-nav__item> <a href=../../final-preparations/adding-the-glaucus-user-and-group/ title="4.2. Adding the glaucus User and Group" class=md-nav__link> 4.2. Adding the glaucus User and Group </a> </li> <li class=md-nav__item> <a href=../../final-preparations/cloning-the-glaucus-repository/ title="4.3. Cloning the glaucus Repository" class=md-nav__link> 4.3. Cloning the glaucus Repository </a> </li> <li class=md-nav__item> <a href=../../final-preparations/initializing-the-glaucus-repository/ title="4.4. Initializing the glaucus Repository" class=md-nav__link> 4.4. Initializing the glaucus Repository </a> </li> <li class=md-nav__item> <a href=../../final-preparations/setting-up-the-environment/ title="4.5. Setting Up the Environment" class=md-nav__link> 4.5. Setting Up the Environment </a> </li> <li class=md-nav__item> <a href=../../final-preparations/about-ccus-and-ceus/ title="4.6. About CCUs and CEUs" class=md-nav__link> 4.6. About CCUs and CEUs </a> </li> <li class=md-nav__item> <a href=../../final-preparations/about-the-test-suites/ title="4.7. About the Test Suites" class=md-nav__link> 4.7. About the Test Suites </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-4 type=checkbox id=nav-4-4 checked> <label class=md-nav__link for=nav-4-4> 5. Constructing the Toolchain </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-4> 5. Constructing the Toolchain </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../introduction/ title="5.1. Introduction" class=md-nav__link> 5.1. Introduction </a> </li> <li class=md-nav__item> <a href=../toolchain-technical-notes/ title="5.2. Toolchain Technical Notes" class=md-nav__link> 5.2. Toolchain Technical Notes </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 5.3. General Compilation Instructions </label> <a href=./ title="5.3. General Compilation Instructions" class="md-nav__link md-nav__link--active"> 5.3. General Compilation Instructions </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#531-the-four-main-stages title="5.3.1. The Four Main Stages" class=md-nav__link> 5.3.1. The Four Main Stages </a> </li> <li class=md-nav__item> <a href=#532-the-terms-construct-and-envenomate title="5.3.2. The Terms Construct and Envenomate" class=md-nav__link> 5.3.2. The Terms Construct and Envenomate </a> </li> <li class=md-nav__item> <a href=#533-where-things-get-manual title="5.3.3. Where Things Get Manual" class=md-nav__link> 5.3.3. Where Things Get Manual </a> </li> <li class=md-nav__item> <a href=#534-the-basic-anatomy-of-a-runsh-script title="5.3.4. The Basic Anatomy of a run.sh Script" class=md-nav__link> 5.3.4. The Basic Anatomy of a run.sh Script </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#5341-the-variables-script title="5.3.4.1. The variables Script" class=md-nav__link> 5.3.4.1. The variables Script </a> </li> <li class=md-nav__item> <a href=#5342-the-check-script title="5.3.4.2. The check Script" class=md-nav__link> 5.3.4.2. The check Script </a> </li> <li class=md-nav__item> <a href=#5343-the-prepare-script title="5.3.4.3. The prepare Script" class=md-nav__link> 5.3.4.3. The prepare Script </a> </li> <li class=md-nav__item> <a href=#5344-the-log-script title="5.3.4.4. The log Script" class=md-nav__link> 5.3.4.4. The log Script </a> </li> <li class=md-nav__item> <a href=#5345-the-construct-and-envenomate-scripts title="5.3.4.5. The construct and envenomate Scripts" class=md-nav__link> 5.3.4.5. The construct and envenomate Scripts </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-5 type=checkbox id=nav-4-5> <label class=md-nav__link for=nav-4-5> 6. Constructing the Chroot Environment </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-5> 6. Constructing the Chroot Environment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../constructing-the-chroot-environment/introduction/ title="6.1. Introduction" class=md-nav__link> 6.1. Introduction </a> </li> <li class=md-nav__item> <a href=../../constructing-the-chroot-environment/stripping/ title="6.2. Stripping" class=md-nav__link> 6.2. Stripping </a> </li> <li class=md-nav__item> <a href=../../constructing-the-chroot-environment/changing-ownership/ title="6.3. Changing Ownership" class=md-nav__link> 6.3. Changing Ownership </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> III. Constructing and Envenomating glaucus </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> III. Constructing and Envenomating glaucus </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> 7. Installing Basic System Cerata </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-1> 7. Installing Basic System Cerata </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/installing-basic-system-cerata/introduction/ title="7.1. Introduction" class=md-nav__link> 7.1. Introduction </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/installing-basic-system-cerata/preparing-virtual-kernel-file-systems/ title="7.2. Preparing Virtual Kernel File Systems" class=md-nav__link> 7.2. Preparing Virtual Kernel File Systems </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/installing-basic-system-cerata/package-management/ title="7.3. Package Management" class=md-nav__link> 7.3. Package Management </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/installing-basic-system-cerata/entering-the-chroot-environment/ title="7.4. Entering the Chroot Environment" class=md-nav__link> 7.4. Entering the Chroot Environment </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/installing-basic-system-cerata/creating-directories/ title="7.5. Creating Directories" class=md-nav__link> 7.5. Creating Directories </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/installing-basic-system-cerata/creating-essential-files-and-symlinks/ title="7.6. Creating Essential Files and Symlinks" class=md-nav__link> 7.6. Creating Essential Files and Symlinks </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/installing-basic-system-cerata/adjusting-the-toolchain/ title="7.8. Adjusting the Toolchain" class=md-nav__link> 7.8. Adjusting the Toolchain </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/installing-basic-system-cerata/about-debugging-symbols/ title="7.10. About Debugging Symbols" class=md-nav__link> 7.10. About Debugging Symbols </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/installing-basic-system-cerata/stripping-again/ title="7.11. Stripping Again" class=md-nav__link> 7.11. Stripping Again </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/installing-basic-system-cerata/cleaning-up/ title="7.12. Cleaning Up" class=md-nav__link> 7.12. Cleaning Up </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> 8. System Configuration </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> 8. System Configuration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/system-configuration/introduction/ title="8.1. Introduction" class=md-nav__link> 8.1. Introduction </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/system-configuration/overview-of-device-and-module-handling/ title="8.2. Overview of Device and Module Handling" class=md-nav__link> 8.2. Overview of Device and Module Handling </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/system-configuration/managing-devices/ title="8.3. Managing Devices" class=md-nav__link> 8.3. Managing Devices </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/system-configuration/general-network-configuration/ title="8.4. General Network Configuration" class=md-nav__link> 8.4. General Network Configuration </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/system-configuration/s6-boot-scripts-usage-and-configuration/ title="8.5. s6 Boot Scripts Usage and Configuration" class=md-nav__link> 8.5. s6 Boot Scripts Usage and Configuration </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/system-configuration/oksh-startup-files/ title="8.6. OKSH Startup Files" class=md-nav__link> 8.6. OKSH Startup Files </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/system-configuration/creating-the-etc-shells-file/ title="8.8. Creating the /etc/shells File" class=md-nav__link> 8.8. Creating the /etc/shells File </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> 9. Making glaucus Bootable </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> 9. Making glaucus Bootable </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/making-glaucus-bootable/introduction/ title="9.1. Introduction" class=md-nav__link> 9.1. Introduction </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/making-glaucus-bootable/creating-the-etc-fstab-file/ title="9.2. Creating the /etc/fstab File" class=md-nav__link> 9.2. Creating the /etc/fstab File </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> 10. The End </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-4> 10. The End </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/the-end/the-end/ title="10.1. The End" class=md-nav__link> 10.1. The End </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/the-end/get-counted/ title="10.2. Get Counted" class=md-nav__link> 10.2. Get Counted </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/the-end/rebooting-the-system/ title="10.3. Rebooting the System" class=md-nav__link> 10.3. Rebooting the System </a> </li> <li class=md-nav__item> <a href=../../../constructing-and-envenomating-glaucus/the-end/what-now/ title="10.4. What Now?" class=md-nav__link> 10.4. What Now? </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> IV. Appendices </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-6> IV. Appendices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../appendices/acronyms-and-terms/ title="A. Acronyms and Terms" class=md-nav__link> A. Acronyms and Terms </a> </li> <li class=md-nav__item> <a href=../../../appendices/acknowledgements/ title="B. Acknowledgements" class=md-nav__link> B. Acknowledgements </a> </li> <li class=md-nav__item> <a href=../../../appendices/cysts/ title="C. Cysts" class=md-nav__link> C. Cysts </a> </li> <li class=md-nav__item> <a href=../../../appendices/s6-boot-scripts/ title="D. s6 Boot Scripts" class=md-nav__link> D. s6 Boot Scripts </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-5 type=checkbox id=nav-6-5> <label class=md-nav__link for=nav-6-5> E. glaucus Licenses </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-5> E. glaucus Licenses </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../appendices/glaucus-licenses/the-isc-license/ title="E.1. The ISC License" class=md-nav__link> E.1. The ISC License </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#531-the-four-main-stages title="5.3.1. The Four Main Stages" class=md-nav__link> 5.3.1. The Four Main Stages </a> </li> <li class=md-nav__item> <a href=#532-the-terms-construct-and-envenomate title="5.3.2. The Terms Construct and Envenomate" class=md-nav__link> 5.3.2. The Terms Construct and Envenomate </a> </li> <li class=md-nav__item> <a href=#533-where-things-get-manual title="5.3.3. Where Things Get Manual" class=md-nav__link> 5.3.3. Where Things Get Manual </a> </li> <li class=md-nav__item> <a href=#534-the-basic-anatomy-of-a-runsh-script title="5.3.4. The Basic Anatomy of a run.sh Script" class=md-nav__link> 5.3.4. The Basic Anatomy of a run.sh Script </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#5341-the-variables-script title="5.3.4.1. The variables Script" class=md-nav__link> 5.3.4.1. The variables Script </a> </li> <li class=md-nav__item> <a href=#5342-the-check-script title="5.3.4.2. The check Script" class=md-nav__link> 5.3.4.2. The check Script </a> </li> <li class=md-nav__item> <a href=#5343-the-prepare-script title="5.3.4.3. The prepare Script" class=md-nav__link> 5.3.4.3. The prepare Script </a> </li> <li class=md-nav__item> <a href=#5344-the-log-script title="5.3.4.4. The log Script" class=md-nav__link> 5.3.4.4. The log Script </a> </li> <li class=md-nav__item> <a href=#5345-the-construct-and-envenomate-scripts title="5.3.4.5. The construct and envenomate Scripts" class=md-nav__link> 5.3.4.5. The construct and envenomate Scripts </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=53-general-compilation-instructions>5.3. General Compilation Instructions</h1> <p>The basic instructions when compiling a ceras include:</p> <ul> <li>The word ceras refers to a single package, while cerata refers to a group of packages.</li> </ul> <h2 id=531-the-four-main-stages>5.3.1. The Four Main Stages</h2> <p>There are four main stages to build glaucus and they are as follows:</p> <ul> <li><strong>cross</strong> - which refers to the cross toolchain stage</li> <li><strong>native</strong> - which refers to the native toolchain stage</li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The cross and native stages both are responsible for building the complete cross-native toolchain.</p> </div> <ul> <li><strong>chroot</strong> - which refers to the chroot environment</li> <li><strong>system</strong> - which refers to the final system glaucus</li> </ul> <h2 id=532-the-terms-construct-and-envenomate>5.3.2. The Terms Construct and Envenomate</h2> <p>The words compilation and build are often referred to as:</p> <ul> <li> <p><strong>construct</strong> - in the cross, native, chroot and system (before adjust is run ) stages</p> </li> <li> <p><strong>envenomate</strong> - in the system stage (after adjust is run)</p> </li> </ul> <h2 id=533-where-things-get-manual>5.3.3. Where Things Get Manual</h2> <p>The scripts responsible for compiling the main stages are located in <code>/home/glaucus/scripts</code> and are as follows:</p> <ul> <li><strong>toolchain</strong> - <code>/home/glaucus/scripts/toolchain/run.sh</code></li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>As explained above, the toolchain <code>run.sh</code> will execute both <code>run.sh</code> scripts for cross and native.</p> </div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Do not attempt to run <code>/home/glaucus/scripts/toolchain/cross/run.sh</code> or <code>/home/glaucus/scripts/toolchain/native/run.sh</code> alone as the latter requires the former to be constructed beforehand, and they both require a common set of environment variables only exported in the <code>variables</code> file <code>/home/glaucus/scripts/toolchain/variables</code> sourced by <code>/home/glaucus/scripts/toolchain/run.sh</code>.</p> </div> <ul> <li><strong>chroot</strong> - <code>/home/glaucus/scripts/chroot/run.sh</code></li> <li><strong>system</strong> - <code>/scripts/system/run.sh</code></li> </ul> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Remember you need to construct both the toolchain and the chroot environment (which will chroot you automatically) before running <code>/scripts/system/run.sh</code>.</p> </div> <h2 id=534-the-basic-anatomy-of-a-runsh-script>5.3.4. The Basic Anatomy of a <code>run.sh</code> Script</h2> <p>The basic anatomy of any <code>run.sh</code> script is described below:</p> <h3 id=5341-the-variables-script>5.3.4.1. The <code>variables</code> Script</h3> <p>All <code>run.sh</code> scripts start by sourcing a <code>variables</code> file located in their relative stages directories. The <code>variables</code> files are responsible for exporting several important environment flags that are used extensively in <code>$stage.ceras</code> files (where stage is cross, native, chroot or system).</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Notice how sourcing is done using the dot operator <code>.</code> for maximum compatibility instead of the word <code>source</code>, which is a synonym for the dot operator in BASH, but not in POSIX.</p> <p>Also notice how sourced scripts don't end with <code>.sh</code>. Only scripts that are manually called end with <code>.sh</code>.</p> </div> <h3 id=5342-the-check-script>5.3.4.2. The <code>check</code> Script</h3> <p>The <code>check</code> script comes next. This script is reponsible for fetching, verifying and extracting, or cloning cerata belonging to a particular stage.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The only stage whose <code>check</code> script doesn't come after its <code>variables</code> script is the system stage, as we should already be inside the chroot environment which may not contain enough utilities needed to run the <code>check</code> script (even though <code>glaucus</code>'s chroot environment has a working internet connection).</p> <p>Instead the <code>check</code> script for the system stage is run just before entering the chroot environment.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>glaucus stores its ceras files, which contain instructions on how to build each ceras in every stage (be it cross, native, chroot or system) in the directory (<code>/home/glaucus/cerata</code>).</p> <p>The <code>check</code> stores the source files of glaucus cerata in the directory <code>/home/glaucus/sources</code>, where cerata that have version numbers other than <code>git</code> are stored as <code>/home/glaucus/sources/$ceras/$ceras-$ver</code> (where <code>$ceras</code> is the name of the ceras (e.g. <code>linux</code>) and <code>$ver</code> is its version (e.g. <code>5.5.5</code>) while its tarball is stored in <code>/home/glaucus/sources/$ceras</code>.</p> <p>Cerata that have versions equal to <code>git</code> (the <code>ver</code> variable in their <code>/home/glaucus/cerata/$ceras/ceras</code> files are equal to <code>git</code>) (e.g. Since there's no released version of <code>zlib-ng</code>, the check script will first check the <code>/home/glaucus/cerata/zlib-ng/ceras</code> file for the <code>ver</code> variable and see if it's equal to <code>git</code> (notice also how no <code>sum</code> variable exists in the <code>ceras</code> file of cerata that have <code>git</code> as their version) and clone its git repository to <code>/home/glaucus/sources/zlib-ng</code>.</p> </div> </div> <h3 id=5343-the-prepare-script>5.3.4.3. The <code>prepare</code> Script</h3> <p>The following sourced script is generally the <code>prepare</code> script that perform some cleaning and preparation before <code>construct</code> or <code>envenomate</code> are run.</p> <p>For example, the toolchain's common <code>prepare</code> script ensures that both the <code>/home/glaucus/toolchain</code> directory and the <code>/toolchain</code> symlink are removed, then recreated with the symlink <code>/toolchain</code> pointing towards <code>/home/glaucus/toolchain</code>. It also creates another symlink <code>/toolchain/lib64</code> which points to <code>/toolchain/lib</code> (absolute path, it points to <code>lib</code> in the directory <code>/toolchain</code> to be more precise) to ensure the sanity of the toolchain.</p> <p>The <code>prepare</code> scripts for both <strong>cross</strong> and <strong>native</strong> ensure that the build directories <code>/temporary/toolchain/cross/builds</code> and <code>/temporary/toolchain/native/builds</code> are empty before the <code>construct</code> script is sourced.</p> <h3 id=5344-the-log-script>5.3.4.4. The <code>log</code> Script</h3> <p>The following source script is <code>log</code> which executes the script passed to it as an argument while logging its stdout and stderr to an <code>out.log</code> file and an <code>err.log</code> file respectively in the directory <code>/home/glaucus/logs/$stage/$try</code> (where <code>$stage</code> is cross, native, chroot or system, and <code>$try</code> is the number of your current run; how many times you've attempted to run that script).</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>In case a command fails, its exit status will be reported in a file called <code>exit</code> in <code>/home/glaucus/logs/$stage/$try</code> (where $stage is cross, native, chroot or system, and <code>$try</code> is the current number of your run; how many times you've attempted to run that script).</p> </div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>When a command fails the running script will automatically abort and return the exit status of the failing function along with the ceras (package) it failed at and at what function (prepare, configure, build or install) and in which stage (cross, native, chroot and system). This will be displayed in the following format:</p> <div class="admonition failure"> <p class=admonition-title>Failure</p> <p>$stage $ceras $function exited with status $?</p> </div> </div> <h3 id=5345-the-construct-and-envenomate-scripts>5.3.4.5. The <code>construct</code> and <code>envenomate</code> Scripts</h3> <p>The scripts passed to the sourced <code>log</code> script in <code>run.sh</code> as arguments are the <code>construct</code> and <code>envenomate</code> scripts. Both the <code>construct</code> and <code>envenomate</code> scripts share an identical structure so the only difference between the two is their names (and one technical minor difference which will be explained shortly):</p> <ul> <li> <p><strong>construct</strong> - is used to refer to the process of building something, or building the tools that will build something in the end. Since the toolchain, the chroot environment and the part of system before adjustment (system <code>linux-headers</code> and <code>musl</code>) are what build the final glaucus system (the part after adjustment), the word construct is used to refer to this process.</p> </li> <li> <p><strong>envenomate</strong> - the use of this term stems from the fact the animal <em>Glaucus</em> consumes venemous creatures (e.g. <em>The Portuguese man o' war</em>) and concentrates their venom in sacs located at the tip of the animal's cerata. Similarly, glaucus builds its final system cerata by envenomating the <code>sac</code> directories (which are basically <code>DESTDIR</code> directories to keep track of installed files) producing <code>venom</code> directories containing both the final tarred archive and a <code>sum</code> file of its contents.</p> </li> </ul> <p>!!! note The only technical difference between <code>construct</code> and <code>envenomate</code> is that envenomate uses directories called <code>sac</code>s as <code>DESTDIR</code>s to keep track of installed files since they're the final system cerata (packages).</p> <ul> <li>If we examine the content of a <code>construct</code> script or the <code>envenomate</code> script, we'll notice that a function with the name of the script is first defined (<code>construct()</code> for <code>construct</code>, and <code>envenomate()</code> for <code>envenomate</code>). This function takes only one argument (and creates the needed <code>sac</code> and <code>venom</code> directories for that one argument in the case of <code>envenomate</code>) and sources the <code>/home/glaucus/cerata/$ceras/ceras</code> file which contains all the required variables needed to construct or envenomate that ceras.</li> </ul> <div class="admonition important"> <p class=admonition-title>Important</p> <p>The use of the word ceras may get confusing at times, so to clear confusion:</p> <ul> <li><strong>ceras</strong> - when mentioned alone it refers to the word <em>package</em></li> <li><strong>ceras file</strong> - the ceras file is a recipe file that only contains variables that provide information about a certain package, but doesn't contain functions or commands as it'll be commonly sourced in many stages so it has to be neutral</li> <li><strong>cerata</strong> - refers to a group of packages or all of glaucus's packages</li> <li><strong>cerata directory</strong> - refers to <code>/home/glaucus/cerata</code></li> <li><strong>temporary system cerata directory</strong> - refers to <code>/home/glaucus/temporary/system/cerata</code></li> <li><strong>$stage.ceras</strong> - files that contain the basic functions needed to build a package at a certain stage (cross, native, chroot or system).</li> </ul> </div> <p>It then sources a <code>$stage.ceras</code> file which contains the basic four functions needed to build a ceras at a certain stageg (cross, native, chroot and system). The <code>$stage.ceras</code> files are located in <code>/home/glaucus/cerata/$ceras</code> and all consist of four main functions that regulate how a <code>construct</code> or <code>envenomate</code> process should be done. The four basic functions in all <code>$stage.ceras</code> files are as follows:</p> <ul> <li><strong>prepare_$stage()</strong> - the prepare function is reponsible for preparing the source files before the rest of the functions are run. This function keeps the upstream cerata sources clean and untouched (like they should always be) by copying the relative <code>$ceras-$ver</code> directory in <code>/home/glaucus/sources/$ceras</code> to a versionless directory with only the name <code>ceras</code> in a temporary location <code>/home/glaucus/temporary/$stage/sources/$ceras</code> where all source modifications (if any) take place.</li> </ul> <p>This helps preserve the sources that the <code>check</code> script originally downloaded or cloned, and prevents the need for redownloading or recloning them whenever a <code>run.sh</code> script is run.</p> <p>Not all cerata have their sources copied, as many of them support being built out of tree (the build directory exists outside of the sources directory). This helps save time as their's no need to copy the sources of these cerata.</p> <p>To conclude only the sources of the following cerata are copied:</p> <ol> <li> <p>cerata which don't support building out of tree (outside their sources directories)</p> </li> <li> <p>cerata with modified sources (to preserve the original sources directory)</p> </li> </ol> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Please ensure that <code>rsync</code> is installed on your host system because the copying process uses it to quickly revert target sources directories located at the temporary <code>/home/glaucus/temporary/$stage/sources</code> directory to their original clean state (as fetched from upstream) as located in the <code>/home/glaucus/sources</code> directory.</p> </div> <ul> <li> <p><strong>configure_$stage()</strong> - This function is responsible for configuring the sources regardless of the method they're configured in. The configure function normally calls the generic <code>./configure</code> preceeding environment variables and flags passed to the configure script. Other commands that belong to this function include:</p> </li> <li> <p><code>./autogen.sh</code></p> </li> <li><code>autoreconf -vfi</code></li> <li>all sorts of configure files including but not limited to <code>config.mk</code>, <code>config.mak</code> and <code>configure.local</code></li> <li>all sort of makefiles including but not limitetd to <code>Makefile</code>, <code>Makefile.am</code>, <code>Makefile.in</code>, <code>Makefile.local</code> and <code>Makefile.PL</code></li> <li>patches and <code>sed</code> commands that modify either configure files or makefiles</li> <li> <p><code>meson</code></p> </li> <li> <p><strong>build_$stage()</strong> - This is where all the magic happens. The build function is responsible for building the sources. It mostly involves of running <code>make</code>, but it may sometimes include <code>samu</code> (a lightweight drop-in replacement for <code>ninja</code>) or build commands that configure and build at the same time (in this case <strong>configure_$stage()</strong> should be left empty (<code>:</code>)).</p> </li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>During the compilation of most cerata, there will be several warnings that scroll by on the screen. These are normal and can safely be ignored. These warnings are as they appear—warnings about deprecated, but not invalid, use of the C or C++ syntax. C standards change fairly often, and some cerata still use the older standard. This is not a problem, but does prompt the warning.</p> </div> <div class="admonition important"> <p class=admonition-title>Important</p> <p>The build instructions assume that the <a href=constructing-the-toolchain-and-the-chroot-environment/preparing-the-host-system/host-system-requirements/ >Host System Requirements</a>, including symbolic links, have been set properly:</p> <ul> <li> <p><code>bash</code> is the shell in use.</p> </li> <li> <p><code>sh</code> is a symbolic link to <code>bash</code>.</p> </li> <li> <p><code>awk</code> is a symbolic link to <code>gawk</code> or <code>mawk</code>.</p> </li> <li> <p><code>yacc</code> is a symbolic link to <code>bison</code>.</p> </li> </ul> </div> <ul> <li><strong>install_$stage()</strong> - This function is reponsible for installing what the build function compiled. Any additional compatibility symlinks are created here as well.</li> </ul> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../toolchain-technical-notes/ title="5.2. Toolchain Technical Notes" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> 5.2. Toolchain Technical Notes </span> </div> </a> <a href=../../constructing-the-chroot-environment/introduction/ title="6.1. Introduction" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Next </span> 6.1. Introduction </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> <p>Copyright © 2019-2020, <a href=mailto:firasuke@glaucuslinux.org>Firas Khalil Khana</a></p> <p>Distributed under the terms of the <a href=https://github.com/glaucuslinux/glaucus/blob/master/LICENSE>ISC</a> License</p> <p>Linux® is the registered trademark of Linus Torvalds in the U.S. and other countries.</p> </div> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/application.c1ad9e36.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script> </body> </html>